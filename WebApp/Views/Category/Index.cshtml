@model IEnumerable<FinTrack.Models.Category>
@{
    ViewData["Title"] = "Categories";
}

<div class="item-container">
    <h2 class="mb-3">Categories</h2>

    <a class="btn btn-primary mb-3" asp-action="Create">‚ûï Create new category</a>

    @if (Model != null && Model.Any())
    {
        <table class="table table-bordered table-striped align-middle">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Tax Amount (%)</th>
                    <th>Tax Type</th>
                    <th>Created At</th>
                    <th>Updated At</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.Id</td>
                        <td>@item.Name</td>
                        <td>@item.TaxAmount</td>
                        <td>@item.TaxType</td>
                        <td>@item.CreatedAt.ToLocalTime().ToString("g")</td>
                        <td>@item.UpdatedAt.ToLocalTime().ToString("g")</td>
                        <td class="text-end">
                            <a asp-action="Update" asp-route-id="@item.Id" class="btn btn-sm btn-warning">‚úèÔ∏è Edit</a>
                            <form asp-action="Delete" asp-route-id="@item.Id" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-sm btn-danger"
                                    onclick="return confirm('Are you sure you want to delete this category?');">
                                    üóëÔ∏è Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="alert alert-info">No categories found.</div>
    }
</div>
@* 
<!-- üîΩ –ù–û–í–ê –ß–ê–°–¢–ò–ù–ê: React-–≤—ñ–¥–∂–µ—Ç -->
<div class="item-container mt-5">
    <h2 class="mb-3">Categories (React widget)</h2>
    <div id="category-react-root"></div>
</div>

@section Scripts {
    <!-- React –∑ CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script type="text/babel">
        const { useEffect, useState } = React;

        function CategoryReactWidget() {
            const [categories, setCategories] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                fetch("/api/v1.0/CategoryApi")
                    .then(resp => {
                        if (!resp.ok) {
                            throw new Error("HTTP " + resp.status);
                        }
                        return resp.json();
                    })
                    .then(data => {
                        setCategories(data || []);
                        setLoading(false);
                    })
                    .catch(err => {
                        setError(err.message);
                        setLoading(false);
                    });
            }, []);

            if (loading) {
                return <p>Loading categories from API...</p>;
            }

            if (error) {
                return <p className="text-danger">Error: {error}</p>;
            }

            if (!categories.length) {
                return <div className="alert alert-info">No categories returned by API.</div>;
            }

            return (
                <table className="table table-bordered table-striped align-middle">
                    <thead className="table-primary">
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Tax Amount (%)</th>
                            <th>Tax Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        {categories.map(c => (
                            <tr key={c.id}>
                                <td>{c.id}</td>
                                <td>{c.name}</td>
                                <td>{c.taxAmount}</td>
                                <td>{c.taxType}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            );
        }

        document.addEventListener("DOMContentLoaded", () => {
            const rootElement = document.getElementById("category-react-root");
            if (rootElement) {
                const root = ReactDOM.createRoot(rootElement);
                root.render(<CategoryReactWidget />);
            }
        });
    </script>
} *@