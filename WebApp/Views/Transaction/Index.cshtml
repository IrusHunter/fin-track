@model FinTrack.Models.ViewModels.TransactionSearchViewModel
@using System.Text.Json
@using System.Linq

@{
    ViewData["Title"] = "Transactions";
}

<div class="item-container">
    <h2>ðŸ’° Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ñ–Ñ—</h2>
    <hr />

    <a asp-action="Create" class="btn btn-success mb-3">âž• Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ñ–ÑŽ</a>

    <partial name="_SearchPartial" model="Model" />

    <form id="anti-forgery-form" method="post" style="display:none;">
        @Html.AntiForgeryToken()
    </form>

    <div id="transactions-react-widget" class="mb-4"></div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <!-- ÐŸÐµÑ€ÐµÐ´Ð°Ñ”Ð¼Ð¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ñ–Ñ— Ð· Razor Ñƒ JS ÑÐº window.transactionsData -->
    <script>
        window.transactionsData = @Html.Raw(
            JsonSerializer.Serialize(
                (Model.Transactions ?? Enumerable.Empty<FinTrack.Models.Transaction>())
                    .Select(t => new {
                        id = t.Id,
                        name = t.Name,
                        sum = t.Sum,
                        sumAfterTax = t.SumAfterTax,
                        category = t.Category != null ? t.Category.Name : null,
                        user = t.User != null ? t.User.UserName : null,
                        createdAt = t.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd")
                    })
            )
        );
    </script>

    <!-- React-Ð²Ñ–Ð´Ð¶ÐµÑ‚ (Babel Ð¿Ñ€ÐµÑÐµÑ‚ Ñ‚Ñ–Ð»ÑŒÐºÐ¸ react) -->
    <script type="text/babel"
            data-presets="react"
            src="~/js/transactions-widget.jsx"
            asp-append-version="true"></script>
}
